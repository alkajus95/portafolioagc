<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Dashboard | Gestor Ético</title>
    <link rel="stylesheet" href="../style.css">
</head>
<body style="padding: 40px 0;">
    <div class="glow-bg"></div>
    <div class="container" style="max-width: 650px;">
        <div style="background:var(--card-bg); padding:40px; border-radius:28px; border:1px solid var(--border);">
            <h2 id="form-title" style="margin-bottom:25px; text-align:center; color:var(--accent);">Gestor de Entradas</h2>
            <form id="form-admin">
                <input type="hidden" id="edit-id">
                <input type="text" id="fecha" placeholder="Fecha" required style="width:100%; padding:12px; margin-bottom:10px; background:#000; color:#fff; border:1px solid var(--border);">
                <input type="text" id="tema" placeholder="Tema" required style="width:100%; padding:12px; margin-bottom:10px; background:#000; color:#fff; border:1px solid var(--border);">
                <textarea id="objetivo" placeholder="Objetivo" style="width:100%; padding:12px; margin-bottom:10px; background:#000; color:#fff; border:1px solid var(--border);"></textarea>
                <textarea id="reconstruccion" placeholder="Reconstrucción" style="width:100%; padding:12px; margin-bottom:10px; background:#000; color:#fff; border:1px solid var(--border);"></textarea>
                <textarea id="queAprendi" placeholder="Aprendizaje" style="width:100%; padding:12px; margin-bottom:10px; background:#000; color:#fff; border:1px solid var(--border);"></textarea>
                <input type="text" id="terminos" placeholder="Términos" style="width:100%; padding:12px; margin-bottom:10px; background:#000; color:#fff; border:1px solid var(--border);">
                <textarea id="impactoSocial" placeholder="Justicia/Solidaridad" style="width:100%; padding:12px; margin-bottom:10px; background:#000; color:#fff; border:1px solid var(--border);"></textarea>
                <button type="submit" class="btn-main" id="btn-label">Publicar</button>
            </form>
        </div>

        <div id="admin-list" style="margin-top:40px;"></div>
    </div>

    <script>
        const API = 'https://68c20740f9928dbf33ed3483.mockapi.io/cx8/etica';

        async function refresh() {
            const res = await fetch(API);
            const data = await res.json();
            const list = document.getElementById('admin-list');
            list.innerHTML = '<h3 style="margin-bottom:15px;">Entradas Existentes</h3>';
            data.reverse().forEach(item => {
                list.innerHTML += `
                    <div style="display:flex; justify-content:space-between; padding:15px; border-bottom:1px solid var(--border); background:rgba(255,255,255,0.02); border-radius:10px; margin-bottom:10px;">
                        <span>${item.tema}</span>
                        <div>
                            <span style="color:orange; cursor:pointer; margin-right:15px;" onclick='load(${JSON.stringify(item)})'>EDITAR</span>
                            <span style="color:#ff4757; cursor:pointer;" onclick="del('${item.id}')">BORRAR</span>
                        </div>
                    </div>
                `;
            });
        }

        async function del(id) { if(confirm('¿Borrar?')) { await fetch(`${API}/${id}`, {method:'DELETE'}); refresh(); } }

        function load(item) {
            document.getElementById('edit-id').value = item.id;
            document.getElementById('fecha').value = item.fecha;
            document.getElementById('tema').value = item.tema;
            document.getElementById('objetivo').value = item.objetivo;
            document.getElementById('reconstruccion').value = item.reconstruccion;
            document.getElementById('queAprendi').value = item.queAprendi;
            document.getElementById('terminos').value = item.terminos;
            document.getElementById('impactoSocial').value = item.impactoSocial;
            document.getElementById('form-title').innerText = "Editando...";
            document.getElementById('btn-label').innerText = "Actualizar";
            window.scrollTo(0,0);
        }

        document.getElementById('form-admin').addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = document.getElementById('edit-id').value;
            const data = {
                fecha: document.getElementById('fecha').value,
                tema: document.getElementById('tema').value,
                objetivo: document.getElementById('objetivo').value,
                reconstruccion: document.getElementById('reconstruccion').value,
                queAprendi: document.getElementById('queAprendi').value,
                terminos: document.getElementById('terminos').value,
                impactoSocial: document.getElementById('impactoSocial').value
            };
            const method = id ? 'PUT' : 'POST';
            const url = id ? `${API}/${id}` : API;
            await fetch(url, { method: method, headers: {'Content-Type': 'application/json'}, body: JSON.stringify(data)});
            location.reload();
        });
        refresh();
    </script>
</body>
</html>